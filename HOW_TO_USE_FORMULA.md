# Как правильно использовать формулу нелинейной усушки

## Общее описание

Наша система использует нелинейную модель усушки для прогнозирования потерь продукции во время хранения. Основная формула:

```
S(t) = a * (1 - exp(-b*t)) + c*t
```

Где:
- `S(t)` - усушка в долях от начального остатка на момент времени `t`
- `t` - время хранения в днях
- `a`, `b`, `c` - коэффициенты модели

## Правильное применение формулы

### 1. Расчет коэффициентов

Для расчета коэффициентов необходимы следующие данные:
- Начальный остаток продукции
- Приход (поступление) продукции
- Расход (продажа/списание) продукции
- Фактический остаток после инвентаризации
- Период хранения в днях

Пример использования в коде:

```python
from src.core.shrinkage_calculator import ShrinkageCalculator

calculator = ShrinkageCalculator()

data = {
    'name': 'Продукт',
    'initial_balance': 100.0,  # Начальный остаток в кг
    'incoming': 20.0,          # Приход в кг
    'outgoing': 30.0,          # Расход в кг
    'final_balance': 85.0,     # Фактический остаток в кг
    'storage_days': 7          # Период хранения в днях
}

# Расчет коэффициентов
result = calculator.calculate_coefficients(data, 'exponential')
coefficients = {
    'a': result['a'],
    'b': result['b'],
    'c': result['c']
}
```

### 2. Прогнозирование усушки

После получения коэффициентов можно прогнозировать усушку:

```python
# Прогноз усушки на 7 дней
t = 7  # дни
shrinkage_rate = calculator._exponential_model(t, coefficients['a'], coefficients['b'], coefficients['c'])

# Абсолютная усушка
initial_balance = 100.0  # кг
absolute_shrinkage = shrinkage_rate * initial_balance

# Прогнозируемый остаток
predicted_balance = initial_balance - absolute_shrinkage
```

### 3. Использование адаптивной модели

Адаптивная модель автоматически улучшает коэффициенты на основе новых данных:

```python
from src.core.adaptive_shrinkage_calculator import AdaptiveShrinkageModel

adaptive_model = AdaptiveShrinkageModel()

# Адаптация коэффициентов на основе новых данных
coefficients = adaptive_model.adapt_coefficients(data, nomenclature='Продукт')

# Прогноз с учетом адаптации
prediction = adaptive_model.predict_with_adaptation(
    t=7,
    initial_balance=100.0,
    nomenclature='Продукт'
)
```

## Интерпретация коэффициентов

### Коэффициент `a` (максимальная усушка)
- Представляет асимптотическое значение усушки
- Чем больше значение, тем больше максимальная усушка
- Для рыбы обычно 0.001 - 0.05 (0.1% - 5%)

### Коэффициент `b` (скорость усушки)
- Определяет скорость достижения максимальной усушки
- Чем больше значение, тем быстрее происходит усушка
- Для рыбы обычно 0.01 - 0.2

### Коэффициент `c` (линейная компонента)
- Представляет постоянную скорость усушки
- Может быть равен нулю для некоторых продуктов
- Для рыбы обычно 0 - 0.01

## Учет внешних факторов

Адаптивная модель учитывает:

### Тип продукции
- Свежая рыба: базовые коэффициенты
- Вяленая/сушеная: уменьшенные коэффициенты
- Слабосоленая: умеренные коэффициенты
- Копченая: повышенные коэффициенты

### Сезонные колебания
- Зима: повышенная усушка (коэффициент 1.15)
- Весна: средняя усушка (коэффициент 1.05)
- Лето: максимальная усушка (коэффициент 1.25)
- Осень: повышенная усушка (коэффициент 1.10)

### Условия хранения
- Температура и влажность влияют на скорость усушки
- Эти данные могут быть переданы в модель для уточнения прогнозов

## Учет излишка при поступлении

Система поддерживает учет постоянного излишка при поступлении:

```python
# Установка процента излишка для конкретной номенклатуры
adaptive_model.set_surplus_rate(0.05, 'СИНЕЦ ВЯЛЕНЫЙ')  # 5% излишка

# Или глобальное значение
adaptive_model.set_surplus_rate(0.03)  # 3% излишка для всех продуктов
```

Излишек применяется только к приходу и учитывается при расчете фактической усушки.

## Рекомендации по использованию

1. **Регулярное обновление коэффициентов**: После каждой инвентаризации обновляйте коэффициенты модели

2. **Проверка адекватности**: Сравнивайте прогнозы с фактическими данными и анализируйте отклонения

3. **Учет специфики продукции**: Используйте соответствующие множители для разных типов рыбы

4. **Мониторинг внешних условий**: Передавайте данные о температуре, влажности и сезоне для улучшения точности

5. **Тестирование на исторических данных**: Проверяйте модель на исторических данных перед применением в production

## Ограничения модели

1. Модель предполагает неотрицательную усушку
2. Точность зависит от качества исходных данных
3. Для редких продуктов может потребоваться больше времени для адаптации
4. Модель не учитывает внезапные изменения условий хранения