# Бизнес-логика системы расчета коэффициентов усушки

## Общее описание

Система предназначена для автоматического анализа и расчета коэффициентов усушки рыбы и рыбопродуктов на основе анализа данных инвентаризации. Система работает с данными инвентаризации, которые содержат информацию о недостачах, но причины этих недостач могут быть разные - усушка, утеря товара и другие факторы.

## Структура данных инвентаризации

### Что содержат документы инвентаризации

Документы инвентаризации содержат следующую информацию:
- Номенклатура продукции
- Начальный остаток на определенную дату
- Приход (поступление) за период
- Расход (списание) за период
- Конечный остаток на определенную дату
- Информацию о недостачах, выявленных по результатам инвентаризации
- Период хранения (в днях)

### Причины недостач по инвентаризации

Недостачи по инвентаризации могут быть вызваны разными причинами:
- Усушка (естественная потеря веса продукции)
- Утеря товара (повреждение, кража, ошибки учета)
- Другие факторы (порча, списание по другим причинам)

## Анализ недостач в системе

### Использование данных инвентаризации

Система использует информацию о недостачах из документов инвентаризации для анализа и определения, какие из них связаны с усушкой. Это ключевое отличие от простого расчета по балансам.

### Принцип FIFO

Принцип FIFO (первым пришёл — первым ушёл) применяется системой при анализе движения партий и определении, какие партии могли быть источником наблюдаемых недостач.

## Типы продукции и коэффициенты усушки

Система различает следующие типы рыбопродуктов:
1. Свежая рыба (fish_fresh)
2. Слабосоленая рыба (fish_salt_cured)
3. Холодное копчение (fish_cold_smoked)
4. Горячее копчение (fish_hot_smoked)
5. Копченая рыба (fish_smoked)
6. Сушеная/вяленая рыба (fish_dried)

Для каждого типа продукции система использует адаптивную модель расчета коэффициентов усушки.

## Процесс обработки данных

1. Загрузка данных из источника (Excel файлы, JSON)
2. Валидация структуры данных
3. Извлечение информации о недостачах из инвентаризаций
4. Анализ причин недостач (усушка vs другие причины)
5. Определение типа продукции
6. Расчет коэффициентов усушки на основе данных о реальных недостачах
7. Адаптация коэффициентов на основе исторических данных
8. Формирование отчетов

## Особенности анализа

### Разделение причин недостач

Система использует адаптивные модели машинного обучения для разделения недостач на:
- Недостачи, связанные с усушкой
- Недостачи, связанные с другими причинами (утеря, порча и т.д.)

### Адаптивные модели

Система использует адаптивные модели для уточнения коэффициентов усушки на основе накопленных данных и улучшения точности определения усушки среди других причин недостач.

## Формулы и расчеты

### Коэффициент усушки
```
Shrinkage_coefficient = Shrinkage / Initial_balance
```

где Shrinkage - это часть недостач, определенная как связанная с усушкой.

### Прогноз усушки
```
Forecast_shrinkage = Initial_balance * Shrinkage_coefficient
```

## Источники данных

1. Excel файлы с данными инвентаризации, содержащими информацию о недостачах
2. JSON файлы с предварительно обработанными данными
3. Исторические данные для адаптации моделей

## Валидация данных

Система проводит валидацию данных на нескольких уровнях:
- Структурная валидация (наличие обязательных полей)
- Логическая валидация (проверка корректности значений)
- Бизнес-валидация (проверка соответствия бизнес-логике)
- Валидация корректности определения причин недостач

## Отчетность

Система генерирует следующие виды отчетов:
- Сводные отчеты по типам продукции
- Детализированные отчеты по каждой номенклатурной позиции
- Анализ причин недостач (усушка vs другие причины)
- Статистика точности прогнозов
- Анализ эффективности адаптивных моделей