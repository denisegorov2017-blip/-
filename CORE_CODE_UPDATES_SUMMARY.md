# Сводка обновлений кода ядра системы

## Обновления в соответствии с обсуждением

Все основные файлы ядра системы были обновлены для четкого отражения того, как система работает с данными инвентаризации:

### 1. Принцип работы системы

Система **анализирует** данные инвентаризации, содержащие информацию о недостачах, для определения части недостач, связанной с усушкой. Важно понимать:

- **Система НЕ рассчитывает усушку по балансам**
- **Система анализирует уже имеющиеся данные о недостачах из инвентаризаций**
- **Причины недостач могут быть разные: усушка, утеря товара, порча и другие факторы**

### 2. Обновленные файлы

#### src/core/data_models.py
- Добавлены пояснения о том, что система работает с данными инвентаризации
- Уточнено, что система анализирует недостачи, а не рассчитывает усушку по балансам

#### src/core/data_processor.py
- Уточнены комментарии о том, что система анализирует недостачи из инвентаризации
- Добавлены пояснения о ключевом моменте: система НЕ рассчитывает усушку по балансам
- Улучшено описание процесса анализа недостач

#### src/core/shrinkage_calculator.py
- Добавлены пояснения в заголовке файла о том, что модуль работает с данными инвентаризации
- Уточнено, что система анализирует данные недостач для определения коэффициентов
- Улучшено описание метода _prepare_time_series с акцентом на анализ недостач из инвентаризации

#### src/core/adaptive_shrinkage_calculator.py
- Добавлены пояснения в заголовке файла о том, что модуль работает с данными инвентаризации
- Уточнено, что модель НЕ рассчитывает усушку по балансам
- Улучшено описание класса с акцентом на анализ недостач из инвентаризаций

#### src/core/shrinkage_system.py
- Добавлены пояснения в заголовке файла о принципах работы системы
- Уточнено, что система НЕ рассчитывает усушку по балансам
- Улучшено описание класса-оркестратора

### 3. Ключевые изменения в логике

#### Анализ недостач
Система выполняет следующий анализ:
1. Загружает данные из документов инвентаризации
2. Извлекает информацию о недостачах (теоретический остаток - фактический остаток)
3. Анализирует причины недостач (усушка vs другие причины)
4. Рассчитывает коэффициенты усушки на основе анализа

#### Не изменилось
- Математические модели расчета коэффициентов остались прежними
- Принцип применения FIFO в анализе движения партий остался прежним
- Адаптивные модели и учет внешних факторов остались прежними

### 4. Важные пояснения

#### Отличие от предыдущего понимания
Ранее могло казаться, что система:
- Рассчитывает усушку по балансам
- Сама определяет, что является усушкой

На самом деле система:
- Анализирует уже имеющиеся данные о недостачах из инвентаризаций
- Определяет, какая часть недостач связана с усушкой
- Рассчитывает коэффициенты на основе этого анализа

#### FIFO принцип
- FIFO применяется системой при анализе движения партий
- FIFO НЕ содержится в самих документах инвентаризации
- Система использует FIFO для определения источников недостач

### 5. Пример работы

Для номенклатуры "ЩУКА СВЕЖАЯ":
- Начальный остаток: 100.0 кг
- Приход: 0.0 кг
- Расход: 0.0 кг
- Конечный остаток: 99.85 кг
- Недостача по инвентаризации: 0.15 кг

Система анализирует недостачу 0.15 кг и определяет, связана ли она с усушкой или другими причинами. Если определено, что вся недостача связана с усушкой, то:
- Коэффициент усушки = 0.15 / 100.0 = 0.0015 (0.15%)