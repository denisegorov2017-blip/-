# Функция ИИ-чата в графических интерфейсах

## Обзор

Система включает встроенный ИИ-чат для помощи пользователям в работе с системой расчета коэффициентов усушки. ИИ-чат предоставляет информацию о работе системы, подготовке данных, интерпретации результатов и решении технических проблем.

## Реализация в GUI

### Tkinter GUI

В Tkinter GUI ИИ-чат реализован в отдельной вкладке интерфейса:

1. Вкладка "ИИ-чат" содержит историю разговора и поле для ввода вопросов
2. Кнопка "Отправить" отправляет вопрос в ИИ и отображает ответ
3. Кнопка "Очистить" очищает историю чата
4. Кнопка "Настройки ИИ" открывает диалог настроек ИИ сервисов

#### Особенности реализации:
- История чата сохраняется в файл `результаты/ai_chat_history.json`
- Настройки ИИ сохраняются в файл `результаты/ai_chat_settings.json`
- Поддержка четырех типов ИИ: встроенного, внешнего, локального и OpenRouter

### Flet GUI

В Flet GUI ИИ-чат реализован в нижней части основного интерфейса:

1. Область чата отображает историю разговора
2. Поле ввода позволяет задавать вопросы ИИ
3. Кнопка отправки сообщения
4. Кнопка очистки чата
5. Кнопка настроек ИИ в заголовке интерфейса

#### Особенности реализации:
- История чата сохраняется в файл `результаты/ai_chat_history.json`
- Настройки ИИ сохраняются в файл `результаты/ai_chat_settings.json`
- Поддержка четырех типов ИИ: встроенного, внешнего, локального и OpenRouter

## Встроенный ИИ

Встроенный ИИ предоставляет ответы на основе ключевых слов в вопросах пользователя:

### Поддерживаемые темы:
1. Приветствия и общие вопросы о помощи
2. Работа с данными инвентаризации
3. Расчет коэффициентов усушки
4. Подготовка данных Excel
5. Точность расчетов и верификация
6. Общие вопросы о системе

### Примеры вопросов:
- "Как работает система расчета коэффициентов усушки?"
- "Что такое инвентаризация?"
- "Какие данные нужны для расчета?"
- "Как интерпретировать точность расчетов?"

## Внешние ИИ сервисы

Система поддерживает подключение внешних ИИ сервисов через API:

### Поддерживаемые сервисы:
1. OpenAI (GPT-3.5, GPT-4, GPT-4 Turbo)
2. Claude (Anthropic)
3. Другие совместимые сервисы

### Настройка внешнего ИИ:
1. Включить использование внешнего ИИ в настройках
2. Ввести действующий API ключ
3. Выбрать модель ИИ
4. При необходимости изменить базовый URL API

### Требования к внешним сервисам:
- Совместимость с OpenAI API
- Действующий API ключ
- Доступ к интернету

## Локальный ИИ (LM Studio)

Система поддерживает использование локальных ИИ моделей через LM Studio:

### Преимущества:
1. Полная конфиденциальность данных
2. Работа без подключения к интернету
3. Бесплатное использование
4. Быстрые ответы (при наличии подходящего оборудования)

### Поддерживаемые модели:
1. Llama 2/3 (7B, 13B, 70B)
2. Mistral (7B)
3. Mixtral (8x7B)
4. Qwen3 (8B, 72B) - отличная поддержка русского языка
5. Gemma3 (8B) - хорошая поддержка русского языка
6. ruGPT-3.5 - специализированная русскоязычная модель
7. Другие модели в формате GGUF

### Настройка локального ИИ:
1. Установить LM Studio (https://lmstudio.ai/)
2. Загрузить и запустить модель в LM Studio
3. Запустить сервер через интерфейс LM Studio
4. Включить использование локального ИИ в настройках
5. Указать URL сервера (по умолчанию http://localhost:1234/v1)
6. Выбрать модель

### Рекомендации по выбору моделей:
- Для ограниченных ресурсов (8 ГБ RAM): Qwen3 4B, Gemma3 4B
- Для средних конфигураций (16 ГБ RAM): Llama 3 8B, Qwen3 8B, Gemma3 8B
- Для мощных конфигураций (32+ ГБ RAM): Llama 3 70B, Mixtral 8x7B

## OpenRouter

Система поддерживает использование OpenRouter как провайдера ИИ моделей:

### Преимущества:
1. Доступ к более чем 400 различных моделей ИИ
2. Единый API для работы с различными моделями
3. Конкуренция цен между провайдерами
4. Автоматическое распределение нагрузки
5. Отказоустойчивость
6. Рейтинги моделей на основе отзывов пользователей

### Поддерживаемые модели:
1. OpenAI (GPT-3.5, GPT-4, GPT-4 Turbo)
2. Claude (Anthropic)
3. Google (PaLM 2, Gemini Pro)
4. Meta (Llama 2, Llama 3, Code Llama)
5. Mistral AI (Mistral 7B, Mixtral 8x7B)
6. Alibaba (Qwen)
7. DeepSeek (DeepSeek)
8. И многие другие

### Настройка OpenRouter:
1. Зарегистрироваться на https://openrouter.ai
2. Получить API ключ
3. Пополнить баланс (при необходимости)
4. Включить использование OpenRouter в настройках
5. Ввести API ключ
6. Выбрать модель

## Техническая реализация

### В ядре системы
Функция реализована в классе [AIChat](file:///c%3A/Users/D_909/Desktop/%D0%B4%D0%BB%D1%8F%20%D0%BD%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0/src/core/ai_chat.py#L27-L271) в модуле `src/core/ai_chat.py`:

```python
class AIChat:
    def __init__(self, config: Optional[Dict[str, Any]] = None):
        # Инициализация чата с настройками
        
    def get_response(self, user_message: str) -> str:
        # Получение ответа от ИИ
        
    def get_external_ai_response(self, user_message: str) -> str:
        # Получение ответа от внешнего ИИ
        
    def get_local_ai_response(self, user_message: str) -> str:
        # Получение ответа от локального ИИ
        
    def get_openrouter_response(self, user_message: str) -> str:
        # Получение ответа от OpenRouter
```

### В графических интерфейсах
Оба GUI используют общий класс `AIChat` для работы с ИИ-чатом.

## Рекомендации для пользователей

1. **Используйте встроенный ИИ для общих вопросов** - он работает без подключения к интернету
2. **Подключайте внешний ИИ для сложных запросов** - более мощные модели могут дать более точные ответы
3. **Используйте локальный ИИ для конфиденциальности** - данные не покидают ваш компьютер
4. **Используйте OpenRouter для доступа к множеству моделей** - единый API для разных поставщиков
5. **Сохраняйте историю чата** - она может быть полезна для обучения системы
6. **Регулярно обновляйте API ключи** - для обеспечения безопасности