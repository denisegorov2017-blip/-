# Система конфигурации проекта

## Обзор

Система конфигурации проекта "Система Расчета Усушки" предоставляет гибкий и надежный способ управления всеми аспектами работы системы. Она основана на иерархическом подходе с валидацией и поддержкой различных профилей конфигурации.

## Архитектура конфигурации

### Основные компоненты

1. **[config.py](file:///c%3A/Users/D_909/Desktop/%D0%B4%D0%BB%D1%8F%20%D0%BD%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0/src/config.py)** - Центральный файл конфигурации, содержащий все настройки по умолчанию и профили
2. **[SettingsManager](file:///c%3A/Users/D_909/Desktop/%D0%B4%D0%BB%D1%8F%20%D0%BD%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0/src/core/settings_manager.py)** - Класс для управления настройками с валидацией и сохранением
3. **CONFIG_VALIDATION_RULES** - Правила валидации для всех настроек

## Структура конфигурации

### Категории настроек

#### 1. Основные настройки расчетов
- `model_type` - Тип используемой модели расчета
- `default_period` - Период расчета по умолчанию
- `min_accuracy` - Минимальный порог точности
- `use_adaptive_model` - Использование адаптивной модели
- `average_surplus_rate` - Средний процент излишка

#### 2. Настройки интерфейса
- `theme` - Тема интерфейса
- `language` - Язык интерфейса
- `window_width`, `window_height` - Размеры окна

#### 3. Настройки вывода и отчетов
- `output_dir` - Директория для результатов
- `auto_open_reports` - Автоматическое открытие отчетов
- `report_theme` - Тема отчетов

#### 4. Настройки базы данных
- `enable_database` - Включение базы данных
- `database_url` - URL подключения
- `database_backup_path` - Путь к резервным копиям
- `database_backup_interval` - Интервал резервного копирования
- `enable_verification` - Включение верификации

#### 5. Настройки производительности
- `max_threads` - Максимальное количество потоков
- `batch_size` - Размер батча для обработки

#### 6. Настройки логирования
- `log_level` - Уровень логирования
- `log_max_size` - Максимальный размер файла лога
- `log_backup_count` - Количество ротаций логов

#### 7. Настройки ИИ
- `enable_external_ai` - Включение внешнего ИИ
- `external_ai_api_key` - API ключ
- `external_ai_model` - Модель ИИ
- `external_ai_base_url` - Базовый URL API

## Профили конфигурации

### Стандартный профиль (`default`)
Используется по умолчанию для обычной работы системы.

### Профиль разработки (`development`)
Настройки для разработки с расширенным логированием и отдельной базой данных.

### Профиль тестирования (`testing`)
Оптимизирован для автоматического тестирования с минимальным выводом и отключенной базой данных.

### Профиль производства (`production`)
Оптимизирован для промышленного использования с ограниченным логированием и частыми резервными копиями.

## Валидация настроек

Система включает строгую валидацию настроек для предотвращения ошибок конфигурации:

- **Типизация** - Проверка соответствия типов данных
- **Диапазоны значений** - Проверка минимальных и максимальных значений
- **Допустимые значения** - Проверка соответствия списку разрешенных значений
- **Обязательные поля** - Проверка наличия критически важных настроек

## Использование в коде

### Получение настроек
```python
from src.core.settings_manager import settings_manager

# Получение значения настройки
accuracy_threshold = settings_manager.get_setting('min_accuracy', 50.0)

# Получение всех настроек
all_settings = settings_manager.get_all_settings()
```

### Установка настроек
```python
# Установка отдельной настройки с валидацией
success = settings_manager.set_setting('min_accuracy', 75.0)

# Обновление нескольких настроек
settings_manager.update_settings({
    'model_type': 'linear',
    'use_adaptive_model': True
})
```

### Сохранение и восстановление
```python
# Сохранение настроек
settings_manager.save_settings()

# Создание резервной копии
settings_manager.backup_settings()

# Восстановление из резервной копии
settings_manager.restore_settings_from_backup('path/to/backup')
```

## Рекомендации по использованию

1. **Используйте профили** - Выбирайте подходящий профиль для вашего сценария использования
2. **Проверяйте валидацию** - Система автоматически проверяет корректность настроек
3. **Создавайте резервные копии** - Регулярно создавайте резервные копии важных настроек
4. **Документируйте изменения** - При изменении настроек документируйте причины изменений
5. **Тестируйте после изменений** - После изменения критических настроек проводите тестирование

## Расширение системы

Для добавления новых настроек:

1. Добавьте параметр в [DEFAULT_CONFIG](file:///c%3A/Users/D_909/Desktop/%D0%B4%D0%BB%D1%8F%20%D0%BD%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0/src/config.py#L14-L102) в [config.py](file:///c%3A/Users/D_909/Desktop/%D0%B4%D0%BB%D1%8F%20%D0%BD%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0/src/config.py)
2. Добавьте правила валидации в [CONFIG_VALIDATION_RULES](file:///c%3A/Users/D_909/Desktop/%D0%B4%D0%BB%D1%8F%20%D0%BD%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0/src/config.py#L173-L320)
3. Обновите GUI для отображения нового параметра (если необходимо)
4. Добавьте тесты для проверки нового параметра