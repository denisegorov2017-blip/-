# Проверка наличия инвентаризаций

## Обзор

В систему добавлена новая функция проверки наличия начальной и конечной инвентаризаций в данных. При обработке данных система автоматически проверяет, присутствуют ли в наборе данных начальный и конечный остатки для каждой номенклатуры.

**ВАЖНО**: Начальный остаток берется на начало периода по датам инвентаризации, а конечный остаток берется на конец периода по датам инвентаризации. Это критически важно для правильного расчета периода хранения и коэффициентов усушки.

## Как это работает

При вызове метода `process_dataset` система выполняет проверку наличия инвентаризаций для каждой позиции в датасете:

1. Проверяется наличие начального остатка (поле `Начальный_остаток`) на начало периода по датам инвентаризации
2. Проверяется наличие конечного остатка (поле `Конечный_остаток`) на конец периода по датам инвентаризации
3. Если начальный остаток отсутствует (None, NaN, пустая строка или другое недопустимое значение), система:
   - Выводит предупреждение об отсутствии начальной инвентаризации
   - Автоматически устанавливает начальный остаток равным 0.0
4. Если конечный остаток отсутствует (None, NaN, пустая строка или другое недопустимое значение), система выводит предупреждение
5. **ВАЖНО**: Система работает с теми данными, которые предоставлены, автоматически устанавливая отсутствующий начальный остаток равным нулю
6. Важно: Остатки берутся на соответствующие даты инвентаризации, определяющие начало и конец периода

**КРИТИЧЕСКИ ВАЖНО**: Начальный остаток берется на начало периода по датам инвентаризации, а конечный остаток - на конец периода по датам инвентаризации. Это критически важно для правильного расчета периода хранения и коэффициентов усушки. Неправильное определение дат может привести к значительным ошибкам в расчетах.

## Обработка NaN и пустых значений

Система корректно обрабатывает различные типы отсутствующих или недопустимых значений в исходных данных:

- **NaN (Not a Number)**: Автоматически преобразуется в 0.0
- **None**: Автоматически преобразуется в 0.0
- **Пустые строки ('')**: Автоматически преобразуется в 0.0
- **Недопустимые числовые значения**: Автоматически преобразуется в 0.0

Это обеспечивает стабильную работу системы даже при наличии некорректных данных в исходных файлах.

## Генерация отчета о нулевых начальных остатках

Система автоматически генерирует отчет о всех номенклатурах с нулевыми начальными остатками (включая те, что были установлены автоматически из отсутствующих значений). Этот отчет выводится в логи и содержит следующую информацию:

- Название номенклатуры
- Начальный остаток (всегда 0.0 для отчета)
- Приход
- Расход
- Конечный остаток (или "Отсутствует" если данные отсутствуют)

Этот отчет позволяет пользователю проверить корректность установленных нулевых остатков перед началом расчетов.

## Типы предупреждений

### Предупреждение об отсутствии начальной инвентаризации
```
WARNING | Для номенклатуры '{название}' отсутствует начальная инвентаризация (на начало периода по датам). Устанавливаем начальный остаток равным 0. Файл: {имя_файла}
```

### Предупреждение об отсутствии конечной инвентаризации
```
WARNING | Для номенклатуры '{название}' отсутствует конечная инвентаризация (на конец периода по датам). Файл: {имя_файла}
```

### Предупреждение об отсутствии обеих инвентаризаций
```
WARNING | Для номенклатуры '{название}' отсутствует конечная инвентаризация. Расчет коэффициентов усушки может быть неточным. Файл: {имя_файла}
```

### Предупреждение об отрицательных значениях инвентаризации
```
WARNING | Для номенклатуры '{название}' {тип} инвентаризация имеет отрицательное значение. Файл: {имя_файла}
```

## Важность проверки

Наличие обеих инвентаризаций (начальной и конечной) критически важно для точного расчета коэффициентов усушки. Если одна из инвентаризаций отсутствует, расчеты могут быть неточными, так как система не сможет правильно определить объем усушки за период.

**КРИТИЧЕСКИ ВАЖНО**: Начальный остаток берется на начало периода по датам инвентаризации, а конечный остаток - на конец периода по датам инвентаризации. Это критически важно для правильного расчета периода хранения и коэффициентов усушки. Неправильное определение дат может привести к значительным ошибкам в расчетах.

## Примеры

### Полные данные (как у "БЫЧКИ ВЯЛЕНЫЕ")
```
data = {
    'Номенклатура': 'БЫЧКИ ВЯЛЕНЫЕ',
    'Начальный_остаток': 0.844,  // Присутствует в исходных данных на начало периода
    'Приход': 1.25,
    'Расход': 0.702,
    'Конечный_остаток': 1.392,   // Присутствует в исходных данных на конец периода
    'Период_хранения_дней': 7
}
// Нет предупреждений, расчет выполняется без дополнительного взаимодействия
```

### Неполные данные
```
data = {
    'Номенклатура': 'Тестовый продукт',
    'Начальный_остаток': None,   // Отсутствует (на начало периода)
    'Приход': 1.25,
    'Расход': 0.702,
    'Конечный_остаток': 1.392,   // Присутствует (на конец периода)
    'Период_хранения_дней': 7
}
// Предупреждение: Для номенклатуры 'Тестовый продукт' отсутствует начальная инвентаризация (на начало периода по датам). Устанавливаем начальный остаток равным 0.
// Расчет выполняется с начальным остатком 0.0
```

## Рекомендации

1. **Проверяйте данные перед обработкой** - убедитесь, что ваши данные содержат обе инвентаризации на соответствующие даты
2. **Обращайте внимание на предупреждения** - они указывают на потенциально неточные расчеты
3. **Проверяйте отчет о нулевых остатках** - используйте автоматически сгенерированный отчет для проверки корректности установленных нулевых остатков
4. **Используйте полные данные** - для получения наиболее точных коэффициентов усушки
5. **Помните о датах** - начальный и конечный остатки берутся на соответствующие даты инвентаризации

## Интеграция в графические интерфейсы

Функция проверки инвентаризаций интегрирована во все графические интерфейсы системы:

### Flet GUI
- Автоматическая проверка при запуске расчета
- Отображение предупреждений в статусной строке
- Поддержка всплывающих уведомлений
- Наличие раздела помощи с информацией о проверке

### Tkinter GUI
- Автоматическая проверка при запуске расчета
- Отображение предупреждений в журнале выполнения операций
- Многостраничный интерфейс с вкладкой помощи
- Подробное описание функции проверки в руководстве пользователя

## Техническая реализация

Функция реализована в методе [_check_inventory_availability](file:///c%3A/Users/D_909/Desktop/%D0%B4%D0%BB%D1%8F%20%D0%BD%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0/src/core/shrinkage_system.py#L116-L195) класса `ShrinkageSystem` и автоматически вызывается при обработке данных.

## Заключение

Функция проверки инвентаризаций является важной частью системы, обеспечивающей прозрачность и надежность расчетов. Она помогает пользователям выявлять потенциально проблемные данные и принимать обоснованные решения о точности полученных результатов. При отсутствии начального остатка система автоматически устанавливает его равным 0.0, что соответствует бизнес-логике отсутствия начального остатка. Дополнительно система генерирует отчет о всех номенклатурах с нулевыми начальными остатками, позволяя пользователю проверить корректность установленных значений.