# Как система читает и обрабатывает отчеты

## Общий процесс чтения отчетов

Система чтения отчетов работает по следующему алгоритму:

### 1. Загрузка файла
- Система использует библиотеку `pandas` для чтения Excel-файлов
- Поддерживаются форматы `.xls` и `.xlsx`
- Файл читается без предварительных предположений о структуре заголовков

### 2. Анализ структуры данных
- Система сканирует файл для определения структуры данных
- Ищет строки, содержащие ключевые слова номенклатур (рыбная продукция)
- Определяет столбцы с числовыми данными (остатки, приход, расход)

### 3. Извлечение данных по номенклатурам
- Находит строки, соответствующие интересующей номенклатуре
- Извлекает числовые значения из стандартных столбцов:
  - Столбец 4: Начальный остаток
  - Столбец 6: Приход
  - Столбец 7: Расход
  - Столбец 8: Конечный остаток

### 4. Расчет фактической усушки
- Теоретический баланс = Начальный остаток + Приход - Расход
- Фактическая усушка = Теоретический баланс - Конечный остаток

### 5. Подготовка данных для расчета коэффициентов
- Формирует структурированный набор данных для обработки
- Добавляет информацию о периоде хранения (по умолчанию 7 дней)

## Пример: Обработка "БЫЧКИ ВЯЛЕНЫЕ"

### Исходные данные из файла:
```
Номенклатура: БЫЧКИ ВЯЛЕНЫЕ
Начальный остаток: [значение из столбца 4]
Приход: [значение из столбца 6]
Расход: [значение из столбца 7]
Конечный остаток: [значение из столбца 8]
```

### Расчет:
1. Теоретический баланс = Начальный остаток + Приход - Расход
2. Фактическая усушка = Теоретический баланс - Конечный остаток

### Подготовка для системы расчета:
```python
product_data = [{
    'Номенклатура': 'БЫЧКИ ВЯЛЕНЫЕ',
    'Начальный_остаток': [значение],
    'Приход': [значение],
    'Расход': [значение],
    'Конечный_остаток': [значение],
    'Период_хранения_дней': 7
}]
```

## Особенности обработки

### Обработка ошибок:
- Система проверяет существование файла
- Обрабатывает некорректные числовые значения (NaN)
- Игнорирует строки с недостаточными данными
- Логирует все ошибки и предупреждения

### Поддержка различных форматов:
- Система адаптивно определяет структуру файла
- Может работать с файлами, имеющими различную структуру столбцов
- Поддерживает многоязычные названия номенклатур

## Интеграция с системой расчета усушки

После извлечения данных система:
1. Преобразует данные в формат DataFrame
2. Передает в ShrinkageSystem для расчета коэффициентов
3. Получает результаты расчета
4. Формирует отчеты и сохраняет результаты

## Заключение

Система чтения отчетов спроектирована для работы с реальными данными инвентаризации, 
извлекая необходимую информацию для расчета коэффициентов усушки без необходимости 
вручную форматировать данные.