# Универсальный алгоритм расчета коэффициентов усушки.txt

"""
Универсальный алгоритм расчета коэффициентов усушки для любой номенклатуры и любого периода

Версия: 1.0
Дата создания: 05.08.2025
Описание: Данный алгоритм позволяет быстро рассчитать коэффициенты a, b и c для формулы усушки
на основе данных товародвижения за заданный период. Алгоритм работает с любыми периодами и 
номенклатурой, используя принцип FIFO и данные инвентаризации.

ОСНОВНЫЕ ДОПУЩЕНИЯ:
- Перед началом периода была проведена инвентаризация, которая списала усушку за предыдущие дни
- Для всех партий, присутствующих на начало периода, усушка равна нулю
- c = 0 (мгновенные потери при приёмке не учитываются)
- b = 0.049 день⁻¹ (среднее значение из рекомендуемого диапазона 0.04-0.05)
- Используется принцип FIFO (First In - First Out) для распределения продаж по партиям
"""

# ШАГ 1: ПОДГОТОВКА ДАННЫХ (2-3 минуты на номенклатуру)
"""
1.1 Загрузите данные из отчета по партиям за нужный период
   - Период определяется как даты между двумя инвентаризациями
   - Пример: "Инвентаризация 000000000000158 от 21.07.2025 22:56:44"

1.2 Для выбранной номенклатуры определите:
   - Начальный остаток на дату начала периода (после инвентаризации)
   - Конечный остаток перед инвентаризацией в конце периода
   - Фактическую усушку = расход по инвентаризации в конце периода

1.3 Соберите все документы движения для этой номенклатуры за период:
   - Приходные накладные
   - Отчеты о продажах
   - Перемещения
   - Инвентаризации
"""

# ШАГ 2: АНАЛИЗ ДВИЖЕНИЯ ПАРТИЙ ПО FIFO (3-4 минуты)
"""
2.1 Постройте хронологию всех операций:
   - Сортируйте все документы по дате и времени (от старых к новым)
   - Для каждой операции определите, какие партии участвуют в движении

2.2 Определите динамику остатков по дням:
   - Создайте таблицу с остатками на начало каждого дня периода
   - Учитывайте FIFO: продажи списываются сначала со старых партий

2.3 Для каждой партии определите:
   - Дату прихода
   - Начальный объем на начало периода
   - Дни хранения в текущем периоде = min(дата_конца_периода - дата_прихода, 7)
   - Усушку, списанную с этой партии (из инвентаризации)
"""

# ШАГ 3: РАСЧЕТ КОЭФФИЦИЕНТОВ (1-2 минуты)
"""
3.1 Используем стандартное значение b = 0.049 день⁻¹
   - Это среднее из рекомендуемого диапазона 0.04-0.05 день⁻¹

3.2 Рассчитайте сумму S для формулы:
   S = Σ[день=1..t] (Масса_на_начало_дня * exp(-0.049 * день))
   
   Для 7-дневного периода коэффициенты экспоненты:
   день 1: exp(-0.049*1) = 0.952
   день 2: exp(-0.049*2) = 0.907
   день 3: exp(-0.049*3) = 0.863
   день 4: exp(-0.049*4) = 0.822
   день 5: exp(-0.049*5) = 0.783
   день 6: exp(-0.049*6) = 0.746
   день 7: exp(-0.049*7) = 0.710

3.3 Рассчитайте коэффициент a:
   a = Фактическая усушка / (0.049 * S)

3.4 Установите c = 0 (по условию задачи)

3.5 Рассчитайте точность модели:
   Расчетная усушка = a * 0.049 * S
   Точность = (1 - |Фактическая усушка - Расчетная усушка| / Фактическая усушка) * 100%
"""

# ШАГ 4: ПРИМЕР РАСЧЕТА ДЛЯ ЛЮБОЙ НОМЕНКЛАТУРЫ
"""
Для номенклатуры "СОЛОМКА КИЖУЧА" за период 15.07.2025-21.07.2025:

1. Начальный остаток: 1.388 кг
2. Усушка по инвентаризации: 0.046 кг
3. Динамика остатков:
   - Дни 1-4: 1.388 кг
   - Дни 5-7: 0.388 кг (после продажи 1.000 кг 19.07.2025)

4. Расчет S:
   S = 1.388×(0.952+0.907+0.863+0.822) + 0.388×(0.783+0.746+0.710)
   S = 1.388×3.544 + 0.388×2.239 = 4.919 + 0.869 = 5.788

5. Расчет a:
   a = 0.046 / (0.049 × 5.788) = 0.162

6. Точность:
   Расчетная усушка = 0.162 × 0.049 × 5.788 = 0.046 кг
   Точность = (1 - |0.046-0.046|/0.046) × 100% = 100%
"""

# ШАГ 5: ФОРМАТ ВЫВОДА РЕЗУЛЬТАТОВ
"""
НАИМЕНОВАНИЕ НОМЕНКЛАТУРЫ|a = [ЗНАЧЕНИЕ]|b = [ЗНАЧЕНИЕ] (день⁻¹)|c = [ЗНАЧЕНИЕ]|Точность = [ЗНАЧЕНИЕ]%|Дата_расчета = [ДД.ММ.ГГ]|Примечание = [ОПЦИОНАЛЬНОЕ ПРИМЕЧАНИЕ]

Пример:
СОЛОМКА КИЖУЧА|a = 0.162|b = 0.049 (день⁻¹)|c = 0|Точность = 100%|Дата_расчета = 05.08.25|Расчет по данным за период 15.07.25-21.07.25. Усушка 0.046 кг за 7 дней хранения.

ПРАВИЛА ФОРМАТИРОВАНИЯ:
- Все значения округлять до 3 знаков после запятой
- Точность указывать с 1 знаком после запятой
- В примечании обязательно указывать период и фактическую усушку
"""

# ШАГ 6: ОСОБЕННОСТИ ДЛЯ РАЗНЫХ ПЕРИОДОВ
"""
6.1 Для периодов меньше 7 дней:
   - Используйте только соответствующее количество дней в расчете S
   - Например, для 5-дневного периода: S = Σ[день=1..5] (Масса_на_начало_дня * exp(-0.049 * день))

6.2 Для периодов больше 7 дней:
   - Разбивайте период на недельные интервалы
   - Рассчитывайте коэффициенты для каждого интервала отдельно
   - Для интервалов, следующих за первым, учитывайте остатки как начальные значения

6.3 При отсутствии данных о весе единицы:
   - Не включайте этот параметр в результаты
   - Сфокусируйтесь на расчете основных коэффициентов a, b и c
"""

# ШАГ 7: ТИПОВЫЕ ОШИБКИ И КАК ИХ ИЗБЕЖАТЬ
"""
7.1 Неправильное применение FIFO:
   - Всегда проверяйте, что продажи списываются сначала со старых партий
   - Убедитесь, что остатки на конец дня = остатки на начало дня - продажи

7.2 Ошибки в определении дней хранения:
   - Для партий, поступивших в течение периода: дни хранения = дата_конца_периода - дата_прихода
   - Для партий на начало периода: дни хранения = номер дня в периоде (1-7)

7.3 Неправильный расчет суммы S:
   - Проверяйте, что для каждого дня используется правильный коэффициент экспоненты
   - Убедитесь, что масса на начало дня соответствует реальным остаткам
"""

# ШАГ 8: АВТОМАТИЗАЦИЯ РАСЧЕТА
"""
8.1 Для ускорения расчетов рекомендуется:
   - Создать шаблон Excel с предустановленными формулами
   - Использовать макросы для автоматического определения движения партий по FIFO
   - Автоматизировать поиск ключевых документов (инвентаризации, приходные накладные)

8.2 Пример структуры Excel-шаблона:
   A: Дата документа | B: Тип документа | C: Партия (дата прихода) | D: Остаток начало дня | 
   E: Приход | F: Расход | G: Остаток конец дня | H: Дни хранения | I: Коэффициент exp(-0.049*день)
   J: Масса*коэффициент для расчета S

8.3 Алгоритм автоматического расчета:
   1. Загрузить данные из отчета
   2. Отфильтровать по номенклатуре
   3. Отсортировать по дате документа
   4. Применить FIFO к распределению продаж
   5. Рассчитать S
   6. Вычислить a
   7. Определить точность
   8. Сформировать результат в требуемом формате
"""

# ШАГ 9: ПРАВИЛА ПРОВЕРКИ КОРРЕКТНОСТИ РЕЗУЛЬТАТОВ
"""
9.1 Проверка диапазона коэффициентов:
   - a должно быть в диапазоне 0.12-0.24 (для рыбы и морепродуктов)
   - b = 0.049 (стандартное значение)
   - c = 0 (по условию)

9.2 Проверка точности модели:
   - Точность > 95% - модель считается точной
   - 90% < Точность ≤ 95% - модель удовлетворительная, требуется проверка данных
   - Точность ≤ 90% - требуется пересмотр данных или метода расчета

9.3 Проверка логичности результатов:
   - Усушка не может превышать начальный остаток
   - Коэффициент a не может быть отрицательным
   - Дни хранения не могут превышать длительность периода
"""

# ШАГ 10: ДОПОЛНИТЕЛЬНЫЕ РЕКОМЕНДАЦИИ
"""
10.1 Для новых номенклатур:
    - Если точность модели низкая, проверьте правильность распределения усушки по партиям
    - При необходимости скорректируйте значение b в пределах 0.04-0.05

10.2 Для автоматизации массовых расчетов:
    - Создайте скрипт на Python с использованием библиотек pandas и numpy
    - Скрипт должен принимать файл отчета и период как входные параметры
    - Результаты сохраняйте в CSV файл в требуемом формате

10.3 При работе с разными типами продукции:
    - Для не-рыбной продукции могут потребоваться другие стандартные значения b
    - Всегда уточняйте диапазоны коэффициентов для конкретного типа продукции
"""