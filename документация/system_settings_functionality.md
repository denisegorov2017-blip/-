# Функция системных настроек в графических интерфейсах

## Обзор

Система теперь включает в себя расширенную функцию системных настроек для обоих графических интерфейсов (Flet и Tkinter). Эта функция предоставляет пользователям возможность настраивать различные аспекты работы системы, включая расчеты, интерфейс, базу данных и вывод результатов.

## Реализация в GUI

### Tkinter GUI

В Tkinter GUI системные настройки реализованы в отдельной вкладке интерфейса:

1. Меню "Настройки" с пунктами:
   - Системные настройки
   - Настройки ИИ-чата

2. Диалог системных настроек содержит вкладки:
   - Общие настройки
   - Настройки интерфейса
   - Настройки базы данных
   - Настройки вывода

3. Кнопки управления:
   - Сохранить
   - Отмена
   - Сбросить (к значениям по умолчанию)

### Flet GUI

В Flet GUI системные настройки реализованы в виде иконки настроек в заголовке интерфейса:

1. Иконка "Системные настройки" в правом верхнем углу
2. Диалог системных настроек с вкладками:
   - Общие настройки
   - Настройки интерфейса
   - Настройки базы данных
   - Настройки вывода

3. Кнопки управления:
   - Сохранить
   - Отмена
   - Сбросить (к значениям по умолчанию)

## Категории настроек

### 1. Общие настройки
- Тип модели расчета (экспоненциальная, линейная, полиномиальная)
- Период расчета по умолчанию (в днях)
- Минимальный порог точности (в процентах)
- Использование адаптивной модели
- Средний процент излишка при поступлении

### 2. Настройки интерфейса
- Тема интерфейса (светлая, темная, системная)
- Язык интерфейса (русский, английский)
- Размер окна (ширина и высота)

### 3. Настройки базы данных
- Включение/выключение базы данных
- URL подключения к базе данных
- Путь к резервным копиям
- Интервал резервного копирования (в часах)
- Включение/выключение верификации коэффициентов

### 4. Настройки вывода
- Директория для сохранения результатов
- Автоматическое открытие отчетов
- Тема отчетов (по умолчанию, темная, светлая, цветная)

## Техническая реализация

### В ядре системы
Функция реализована в классе `SettingsManager` в модуле `src/core/settings_manager.py`:

```python
class SettingsManager:
    def __init__(self, settings_file: str = "результаты/system_settings.json"):
        # Инициализация менеджера настроек
        
    def load_settings(self) -> Dict[str, Any]:
        # Загрузка настроек из файла
        
    def save_settings(self) -> bool:
        # Сохранение настроек в файл
        
    def get_setting(self, key: str, default: Optional[Any] = None) -> Any:
        # Получение значения настройки
        
    def set_setting(self, key: str, value: Any) -> None:
        # Установка значения настройки
        
    def update_settings(self, new_settings: Dict[str, Any]) -> None:
        # Обновление нескольких настроек
        
    def reset_to_defaults(self) -> None:
        # Сброс настроек к значениям по умолчанию
        
    def backup_settings(self, backup_file: Optional[str] = None) -> bool:
        # Создание резервной копии настроек
```

### В графических интерфейсах
Оба GUI используют общий класс `SettingsManager` для работы с системными настройками.

## Хранение настроек

Настройки сохраняются в формате JSON в файле `результаты/system_settings.json`. При первом запуске система создает этот файл с настройками по умолчанию.

## Рекомендации для пользователей

1. **Используйте системные настройки для персонализации** - настройте интерфейс под свои предпочтения
2. **Настройте параметры расчета** - выберите оптимальные параметры для вашей задачи
3. **Настройте базу данных** - при необходимости измените параметры подключения
4. **Настройте вывод результатов** - укажите удобную директорию для сохранения отчетов
5. **Создавайте резервные копии** - регулярно создавайте резервные копии важных настроек
6. **Используйте сброс к значениям по умолчанию** - если настройки перестали работать корректно

## Известные ограничения

1. Для применения некоторых настроек (например, размера окна) может потребоваться перезапуск приложения
2. Настройки языка интерфейса применяются только к новым элементам интерфейса
3. Резервные копии настроек создаются вручную пользователем