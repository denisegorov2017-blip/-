# Обработка данных инвентаризации

## Введение

Этот документ описывает процесс обработки данных инвентаризации в системе расчета коэффициентов усушки. Важно понимать, что система работает с данными инвентаризации, которые содержат информацию о недостачах, но причины этих недостач могут быть разные - усушка, утеря товара и другие факторы.

## Структура данных инвентаризации

### Основные поля данных

Документы инвентаризации содержат следующие обязательные поля:

1. **Номенклатура** - наименование товара
2. **Начальный остаток** - количество товара на начало периода
3. **Приход** - количество поступившего товара за период
4. **Расход** - количество списанного товара за период
5. **Конечный остаток** - количество товара на конец периода
6. **Информация о недостачах** - данные о выявленных недостачах по результатам инвентаризации
7. **Период хранения (дней)** - длительность периода хранения в днях

### Причины недостач по инвентаризации

Недостачи по инвентаризации могут быть вызваны разными причинами:
- Усушка (естественная потеря веса продукции)
- Утеря товара (повреждение, кража, ошибки учета)
- Другие факторы (порча, списание по другим причинам)

## Процесс обработки данных

### 1. Загрузка и парсинг данных

Система поддерживает несколько форматов входных данных:
- Excel файлы (.xlsx, .xls)
- JSON файлы

При загрузке данных система выполняет:
1. Проверку структуры файла
2. Валидацию обязательных полей
3. Извлечение информации о недостачах
4. Преобразование данных в единый формат

### 2. Валидация данных

Перед началом анализа система проводит валидацию:
- Проверка на наличие всех обязательных полей
- Проверка корректности числовых значений
- Проверка на отрицательные значения (где это недопустимо)
- Проверка логической согласованности данных
- Валидация информации о недостачах

### 3. Анализ причин недостач

Система анализирует информацию о недостачах из инвентаризаций для определения, какие из них связаны с усушкой, а какие с другими причинами.

### 4. Расчет коэффициента усушки

Коэффициент усушки определяется как:
```
Коэффициент_усушки = Усушка / Начальный_остаток
```

где "Усушка" - это часть недостач, определенная как связанная с усушкой.

## Особенности обработки

### Разделение причин недостач

Система использует адаптивные модели машинного обучения для разделения недостач на:
- Недостачи, связанные с усушкой
- Недостачи, связанные с другими причинами (утеря, порча и т.д.)

### Принцип FIFO

Система применяет принцип FIFO (первым пришёл — первым ушёл) при анализе движения партий для определения источников недостач.

### Учет излишков

Система учитывает возможные излишки при поступлении продукции, которые могут влиять на анализ недостач.

### Адаптивные модели

Для повышения точности определения усушки среди других причин недостач система использует адаптивные модели, которые корректируют коэффициенты на основе исторических данных.

## Типы продукции

Система различает следующие типы рыбопродуктов:
1. Свежая рыба
2. Слабосоленая рыба
3. Холодное копчение
4. Горячее копчение
5. Копченая рыба
6. Сушеная/вяленая рыба

Для каждого типа применяются индивидуальные коэффициенты и модели анализа.

## Обработка ошибок

Система предусматривает обработку следующих типов ошибок:
- Некорректная структура файлов
- Отсутствие обязательных данных
- Логические несоответствия в данных
- Недопустимые значения полей
- Некорректная информация о недостачах

При обнаружении ошибок система формирует подробные отчеты для пользователя.

## Форматы выходных данных

Система генерирует результаты в следующих форматах:
- JSON - для дальнейшей обработки
- HTML - для визуализации результатов
- CSV - для импорта в другие системы

## Пример обработки

Для номенклатуры "ЩУКА СВЕЖАЯ":
- Начальный остаток: 100.0 кг
- Приход: 0.0 кг
- Расход: 0.0 кг
- Конечный остаток: 99.85 кг
- Недостача по инвентаризации: 0.15 кг
- Период хранения: 7 дней

Анализ:
- Система анализирует недостачу 0.15 кг для определения, связана ли она с усушкой или другими причинами
- Если определено, что вся недостача связана с усушкой, то:
  - Коэффициент усушки = 0.15 / 100.0 = 0.0015 (0.15%)

## Рекомендации по подготовке данных

1. Убедитесь, что все обязательные поля присутствуют в данных
2. Проверьте корректность числовых значений
3. Убедитесь, что информация о недостачах корректно отражена
4. Убедитесь, что период хранения указан правильно
5. Используйте согласованные единицы измерения (рекомендуется кг)