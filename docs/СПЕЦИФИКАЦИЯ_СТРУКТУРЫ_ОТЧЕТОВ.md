# СПЕЦИФИКАЦИЯ СТРУКТУРЫ ОТЧЕТОВ
## Для системы расчета коэффициентов нелинейной усушки

### 1. ОБЩИЕ ПОЛОЖЕНИЯ

#### 1.1 Назначение документа
Данный документ описывает структуру отчетов, используемых в системе расчета коэффициентов нелинейной усушки, включая форматы файлов, структуру данных и алгоритмы извлечения информации. Особое внимание уделяется работе с многослойными отчетами и сохранению их иерархической структуры.

### 2. ФОРМАТЫ ФАЙЛОВ

#### 2.1 Поддерживаемые форматы
Система поддерживает следующие форматы файлов:
- **Excel**: .xlsx, .xlsm, .xls — как основной формат для входных данных.
- **JSON**: структурированные данные для внутреннего представления, анализа и обмена. **Является каноническим форматом системы.**
- **HTML**: формат для финальных отчетов и визуализаций.

#### 2.2 Многослойные отчеты
Система поддерживает работу с многослойными отчетами, где каждый лист Excel может содержать отдельную секцию данных. Имена и порядок листов сохраняются при преобразовании в JSON.

### 3. СТРУКТУРА ОТЧЕТОВ

Отчеты имеют иерархическую структуру, которая полностью отражается в каноническом JSON представлении.

### 4. АЛГОРИТМЫ ИЗВЛЕЧЕНИЯ ДАННЫХ

Алгоритмы парсинга нацелены на извлечение данных из Excel и их преобразование в структурированный DataFrame для дальнейших расчетов.

### 5. СОХРАНЕНИЕ ИЕРАРХИИ ПРИ ПРЕОБРАЗОВАНИИ В JSON

При преобразовании Excel в JSON сохраняется полная структура документа:
```json
{
  "source_file": "Отчет.xlsx",
  "sheet_count": 2,
  "sheets": {
    "Продажи": [
      {"Дата": "01.01.2025", "Товар": "Рыба", "Количество": 100},
      {"Дата": "02.01.2025", "Товар": "Рыба", "Количество": 150}
    ],
    "Остатки": [
      {"Товар": "Рыба", "Начальный": 200, "Конечный": 250}
    ]
  }
}
```

### 6. СПЕЦИФИКАЦИЯ СТРУКТУРЫ ДАННЫХ

#### 6.1 Унифицированная структура данных
Система использует унифицированную структуру данных для хранения информации, которая валидируется через Pydantic модели (см. `data_models.py`).

#### 6.2 Структура временных рядов
Для расчета коэффициентов используются временные ряды, формируемые из набора данных.

### 7. ЗАКЛЮЧЕНИЕ

Спецификация структуры отчетов определяет подходы к обработке многослойных Excel отчетов и их преобразованию в канонический формат JSON для дальнейшей обработки и анализа.