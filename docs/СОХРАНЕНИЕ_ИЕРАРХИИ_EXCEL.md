# Инструкция: Работа с иерархией Excel и форматом JSON

## 1. Введение

В системе реализованы расширенные возможности для работы с многослойными Excel файлами. Ключевой особенностью является преобразование Excel в структурированный **JSON-формат**, который является основным для анализа и обработки данных, с возможностью последующей обратной конвертации.

## 2. Зачем нужна конвертация в JSON?

Хотя Excel удобен для людей, для искусственного интеллекта его структура неоднозначна. Преобразование в **JSON** — это ключевой шаг, который переводит визуальную таблицу в четкий, структурированный формат, понятный ИИ.

**Это предпочтительный метод подготовки данных для анализа, отладки и доработки системы с помощью Gemini.** Он гарантирует, что ИИ получит точные и неискаженные данные для максимально качественной работы.

## 3. Основные возможности

- **Сохранение иерархии листов:** Поддержка многослойных Excel файлов (.xlsx, .xlsm, .xls) с сохранением структуры и имен листов.
- **Преобразование в JSON:** Конвертация данных из Excel в четко структурированный JSON.
- **Восстановление из JSON:** Обратное преобразование из JSON в Excel-файл.
- **Анализ метаданных:** Возможность получить сводку по содержимому листов (количество строк, колонок).

## 4. Ключевые модули и использование

#### 4.1 Преобразование Excel → JSON

Для преобразования используется класс `ExcelHierarchyPreserver` из модуля `excel_hierarchy_preserver.py`.

```python
from excel_hierarchy_preserver import ExcelHierarchyPreserver

# Создание объекта для сохранения иерархии
preserver = ExcelHierarchyPreserver("отчет.xlsx")

# Получение информации о структуре (опционально)
structure_info = preserver.get_structure_info()
print(structure_info)

# Преобразование в JSON
preserver.to_json("иерархия.json")
```

#### 4.2 Восстановление Excel ← JSON

Функция `json_to_excel` из того же модуля позволяет восстановить Excel файл.

```python
from src.core.excel_hierarchy_preserver import json_to_excel

# Восстановление Excel из JSON
json_to_excel("иерархия.json", "восстановленный_отчет.xlsx")
```

## 5. Тестирование

Функциональность сохранения и восстановления иерархии тестируется в файлах:
- `test_excel_hierarchy.py`
- `test_reverse_conversion.py`

## 6. Преимущества JSON-подхода

- **Надежность:** Явная структура JSON исключает двусмысленность, в отличие от визуальной структуры Excel.
- **Универсальность:** JSON является стандартом для обмена данными между системами и для взаимодействия с ИИ.
- **Чистота данных:** Формат содержит только данные, без "визуального шума" (стилей, формул), что идеально для анализа.