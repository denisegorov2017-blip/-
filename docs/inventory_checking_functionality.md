# Функция проверки инвентаризаций в графических интерфейсах

## Обзор

Система автоматически проверяет наличие начальной и конечной инвентаризаций во всех графических интерфейсах. Эта функция помогает пользователям выявлять потенциально неточные расчеты коэффициентов усушки, когда в данных отсутствуют необходимые инвентаризации.

## Реализация в GUI

### Tkinter GUI

В Tkinter GUI функция проверки инвентаризаций интегрирована в основной процесс расчета:

1. При выборе Excel файла и запуске расчета система автоматически проверяет наличие начальной и конечной инвентаризаций
2. Если инвентаризации отсутствуют, система выводит предупреждения в журнал выполнения операций
3. При отсутствии начального остатка система автоматически устанавливает его равным 0.0
4. Расчет продолжается с имеющимися данными без запроса дополнительного ввода от пользователя
5. Все предупреждения отображаются в реальном времени в журнале операций

#### Особенности реализации:
- Проверка выполняется в методе `process_dataset` класса `ShrinkageSystem`
- Предупреждения выводятся с использованием системы логирования
- Начальный остаток берется на начало периода по датам инвентаризации
- Конечный остаток берется на конец периода по датам инвентаризации

### Flet GUI

В Flet GUI функция проверки инвентаризаций также интегрирована в основной процесс расчета:

1. При выборе Excel файла и запуске расчета система автоматически проверяет наличие инвентаризаций
2. Если инвентаризации отсутствуют, система выводит предупреждения в статусную строку
3. При отсутствии начального остатка система автоматически устанавливает его равным 0.0
4. Расчет продолжается с имеющимися данными
5. Все предупреждения отображаются в реальном времени в интерфейсе

#### Особенности реализации:
- Проверка выполняется в методе `process_dataset` класса `ShrinkageSystem`
- Предупреждения выводятся через систему обновления статуса
- Поддержка всплывающих уведомлений о статусе операций
- Наличие раздела помощи с информацией о проверке инвентаризаций

## Типы предупреждений

### Предупреждение об отсутствии начальной инвентаризации
```
WARNING | Для номенклатуры '{название}' отсутствует начальная инвентаризация (на начало периода по датам). Устанавливаем начальный остаток равным 0. Файл: {имя_файла}
```

### Предупреждение об отсутствии конечной инвентаризации
```
WARNING | Для номенклатуры '{название}' отсутствует конечная инвентаризация (на конец периода по датам). Файл: {имя_файла}
```

### Предупреждение об отсутствии обеих инвентаризаций
```
WARNING | Для номенклатуры '{название}' отсутствует конечная инвентаризация. Расчет коэффициентов усушки может быть неточным. Файл: {имя_файла}
```

## Важные принципы

### Работа с предоставленными данными
Система работает с теми данными, которые предоставлены в исходных данных. Если начальный остаток присутствует (как в случае с "БЫЧКИ ВЯЛЕНЫЕ"), система использует его без запроса дополнительного ввода. При отсутствии начального остатка система автоматически устанавливает его равным 0.0.

### Обработка недопустимых значений
Система корректно обрабатывает различные типы отсутствующих или недопустимых значений в исходных данных:
- **NaN (Not a Number)**: Автоматически преобразуется в 0.0
- **None**: Автоматически преобразуется в 0.0
- **Пустые строки ('')**: Автоматически преобразуется в 0.0
- **Недопустимые числовые значения**: Автоматически преобразуется в 0.0

### Точность дат инвентаризации
- Начальный остаток берется на начало периода по датам инвентаризации
- Конечный остаток берется на конец периода по датам инвентаризации
- Это критически важно для правильного расчета периода хранения и коэффициентов усушки

### Неизменяемость данных
Система не изменяет предоставленные данные, кроме случаев отсутствия начального остатка, когда она автоматически устанавливает его равным 0.0. Все предупреждения служат только для информирования пользователя о потенциально неточных расчетах.

## Примеры

### Полные данные (как у "БЫЧКИ ВЯЛЕНЫЕ")
```python
data = {
    'Номенклатура': 'БЫЧКИ ВЯЛЕНЫЕ',
    'Начальный_остаток': 0.844,  # Присутствует в исходных данных
    'Приход': 1.25,
    'Расход': 0.702,
    'Конечный_остаток': 1.392,   # Присутствует в исходных данных
    'Период_хранения_дней': 7
}
# Нет предупреждений, расчет выполняется без дополнительного взаимодействия
```

### Неполные данные
```python
data = {
    'Номенклатура': 'Тестовый продукт',
    'Начальный_остаток': None,   # Отсутствует
    'Приход': 1.25,
    'Расход': 0.702,
    'Конечный_остаток': 1.392,   # Присутствует
    'Период_хранения_дней': 7
}
# Предупреждение: Для номенклатуры 'Тестовый продукт' отсутствует начальная инвентаризация (на начало периода по датам). Устанавливаем начальный остаток равным 0.
# Расчет выполняется с начальным остатком 0.0, без запроса ввода
```

## Влияние на точность расчетов

Функция проверки инвентаризаций улучшает работу системы следующим образом:

1. **Прозрачность**: Пользователи получают четкую информацию о качестве исходных данных
2. **Надежность**: Система не пытается компенсировать отсутствующие данные предположениями
3. **Соответствие реальности**: Система работает так, как ожидается при обработке реальных данных
4. **Отсутствие искажений**: Предоставленные данные не изменяются системой, кроме случаев отсутствия начального остатка

## Техническая реализация

### В ядре системы
Функция реализована в методе [_check_inventory_availability](file:///c%3A/Users/D_909/Desktop/%D0%B4%D0%BB%D1%8F%20%D0%BD%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE%20%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0/src/core/shrinkage_system.py#L116-L181) класса `ShrinkageSystem`:

```python
def _check_inventory_availability(self, dataset: pd.DataFrame, source_filename: str) -> pd.DataFrame:
    """
    Проверяет наличие начальной и конечной инвентаризации в данных.
    Выводит предупреждение, если данные неполные.
    
    ВАЖНО: Начальный остаток берется на начало периода по датам инвентаризации.
    Конечный остаток берется на конец периода по датам инвентаризации.
    Это критически важно для правильного расчета периода хранения и коэффициентов усушки.
    """
    # Проверка наличия инвентаризаций для каждой номенклатуры
    # Вывод предупреждений при отсутствии данных
    # Установка начального остатка равным 0.0 при его отсутствии
    # Возврат обновленного датасета
```

### В графических интерфейсах
Все GUI используют общий метод `process_dataset` класса `ShrinkageSystem`, который автоматически вызывает проверку инвентаризаций.

## Рекомендации для пользователей

1. **Проверяйте данные перед обработкой** - убедитесь, что ваши данные содержат обе инвентаризации на соответствующие даты
2. **Обращайте внимание на предупреждения** - они указывают на потенциально неточные расчеты
3. **Используйте полные данные** - для получения наиболее точных коэффициентов усушки
4. **Помните о датах** - начальный и конечный остатки берутся на соответствующие даты инвентаризации