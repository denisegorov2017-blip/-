# Руководство для Qwen Code по работе с этим проектом

## Контекст

В связи с тем, что путь к проекту (`C:\Users\D_909\Desktop\расчет коэффициентов нелинейной усушки, и предварительный расчет усушки 1.1`) содержит кириллические символы и является длинным, прямые вызовы `run_shell_command` для выполнения команд внутри этой папки (например, `pip install`, `python <скрипт>`) могут завершаться с ошибкой из-за проблем с обработкой путей в командной оболочке Windows.

## Основное правило

**Вместо прямых команд в `run_shell_command` для операций внутри папки проекта, необходимо создавать и использовать временные Python-скрипты-помощники.**

Этот подход обеспечивает надежное выполнение команд, так как Python лучше справляется с обработкой сложных путей.

## Рабочий процесс

1.  **Идентификация задачи:** Определить, какую команду нужно выполнить (создать venv, установить зависимости, запустить скрипт).

2.  **Создание скрипта-помощника:**
    *   Создать временный Python-файл (например, `helper.py`) в простом, доступном месте (например, `C:\Users\D_909\helper.py`).
    *   Внутри этого скрипта использовать модули `os` и `subprocess` для выполнения нужной операции. Путь к проекту должен быть указан как "сырая" строка (raw string): `r"C:\..."`.
    *   Скрипт должен содержать подробные `print`'ы для отслеживания своего выполнения и `try...except` для перехвата ошибок.

3.  **Запуск скрипта-помощника:**
    *   Выполнить созданный скрипт с помощью `run_shell_command`:
        ```bash
        python C:\Users\D_909\helper.py
        ```

4.  **Анализ результата:** Проверить `stdout` и `stderr` на наличие ошибок.

5.  **Удаление скрипта-помощника:** После успешного выполнения **обязательно** удалить временный скрипт, чтобы не засорять корневую директорию пользователя:
    ```bash
    del C:\Users\D_909\helper.py
    ```

## Примеры

*   **Для создания venv:** Скрипт-помощник импортирует `subprocess` и `os`, а затем запускает `subprocess.run(["python", "-m", "venv", "venv"], cwd=project_path)`.
*   **Для установки зависимостей:** Скрипт-помощник определяет путь к `python.exe` внутри `venv` и запускает `subprocess.run([python_executable, "-m", "pip", "install", "-r", requirements_path])`.
*   **Для запуска основного скрипта:** Аналогично, скрипт-помощник запускает основной скрипт проекта через `subprocess.run([python_executable, script_path])`.

## Структура проекта

Проект состоит из следующих основных компонентов:

1.  **Папка `исходные_данные`:** Содержит исходные отчеты и данные.
    *   `Для_расчета_коэфф`: Отчеты для расчета коэффициентов усушки.
    *   `Для_передварительной_усушки`: Отчеты для предварительного расчета усушки.

2.  **Папка `скрипты`:** Содержит все Python-скрипты проекта.
    *   `improved_coefficient_calculator.py`: Основной скрипт для расчета коэффициентов усушки.
    *   `preliminary_shrinkage_calculator.py`: Скрипт для предварительного расчета усушки.
    *   `compare_shrinkage.py`: Скрипт для сравнения результатов расчета усушки.
    *   `compare_initial_balances.py`: Скрипт для сравнения начальных остатков.
    *   `analytics.py`: Модуль с функциями аналитики и прогнозирования.

3.  **Папка `результаты`:** Содержит все результаты работы скриптов.
    *   `коэффициенты_усушки_улучшенные.csv/html`: Рассчитанные коэффициенты усушки.
    *   `предварительный_расчет_усушки.csv/html`: Результаты предварительного расчета усушки.
    *   `сравнение_усушки.csv/html`: Сравнение результатов предварительного расчета и фактической усушки.
    *   `сравнение_остатков.csv`: Сравнение начальных остатков из разных отчетов.

## Новые возможности

Недавно были добавлены следующие возможности:

1.  **Поддержка параметра `--calculation_start_date`:** Оба основных скрипта (`improved_coefficient_calculator.py` и `preliminary_shrinkage_calculator.py`) теперь поддерживают параметр командной строки `--calculation_start_date`, который позволяет указать дату начала расчета. Это позволяет извлекать начальные остатки на заданную дату, обеспечивая сравнимость результатов.

2.  **Новые bat-скрипты:** Для удобства запуска были созданы новые bat-скрипты:
    *   `run_preliminary.bat`: Запуск предварительного расчета усушки.
    *   `run_comparison.bat`: Запуск сравнения результатов расчета усушки.
    *   `run_balance_comparison.bat`: Запуск сравнения начальных остатков.

## Рекомендации по работе

1.  **Используйте bat-скрипты для запуска:** Для удобства рекомендуется использовать созданные bat-скрипты для запуска различных операций.

2.  **Указывайте дату начала расчета:** При запуске скриптов расчета коэффициентов и предварительного расчета усушки указывайте одинаковую дату начала расчета с помощью параметра `--calculation_start_date`, чтобы обеспечить сравнимость результатов.

3.  **Проверяйте зависимости:** Убедитесь, что все необходимые зависимости установлены. Список зависимостей находится в файле `requirements.txt`.

4.  **Изучите индекс проекта:** Подробное описание структуры проекта и назначения файлов находится в файле `project_index.md`.