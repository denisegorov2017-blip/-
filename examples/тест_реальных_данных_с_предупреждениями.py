#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–¢–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö "–ë–´–ß–ö–ò –í–Ø–õ–ï–ù–´–ï".
"""

import sys
import os
import pandas as pd

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ src –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '../src')))

from core.shrinkage_system import ShrinkageSystem


def test_real_data_with_warnings():
    """–¢–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö."""
    print("üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö")
    print("=" * 70)
    
    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö "–ë–´–ß–ö–ò –í–Ø–õ–ï–ù–´–ï"
    # –ù–æ —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è–º–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
    test_data = [
        {
            '–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞': '–ë–´–ß–ö–ò –í–Ø–õ–ï–ù–´–ï (–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)',
            '–ù–∞—á–∞–ª—å–Ω—ã–π_–æ—Å—Ç–∞—Ç–æ–∫': 0.844,
            '–ü—Ä–∏—Ö–æ–¥': 1.25,
            '–†–∞—Å—Ö–æ–¥': 0.702,
            '–ö–æ–Ω–µ—á–Ω—ã–π_–æ—Å—Ç–∞—Ç–æ–∫': 1.392,
            '–ü–µ—Ä–∏–æ–¥_—Ö—Ä–∞–Ω–µ–Ω–∏—è_–¥–Ω–µ–π': 7
        },
        {
            '–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞': '–ë–´–ß–ö–ò –í–Ø–õ–ï–ù–´–ï (–±–µ–∑ –Ω–∞—á–∞–ª—å–Ω–æ–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏)',
            '–ù–∞—á–∞–ª—å–Ω—ã–π_–æ—Å—Ç–∞—Ç–æ–∫': 0.0,  # –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
            '–ü—Ä–∏—Ö–æ–¥': 1.25,
            '–†–∞—Å—Ö–æ–¥': 0.702,
            '–ö–æ–Ω–µ—á–Ω—ã–π_–æ—Å—Ç–∞—Ç–æ–∫': 1.392,
            '–ü–µ—Ä–∏–æ–¥_—Ö—Ä–∞–Ω–µ–Ω–∏—è_–¥–Ω–µ–π': 7
        },
        {
            '–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞': '–ë–´–ß–ö–ò –í–Ø–õ–ï–ù–´–ï (–±–µ–∑ –∫–æ–Ω–µ—á–Ω–æ–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏)',
            '–ù–∞—á–∞–ª—å–Ω—ã–π_–æ—Å—Ç–∞—Ç–æ–∫': 0.844,
            '–ü—Ä–∏—Ö–æ–¥': 1.25,
            '–†–∞—Å—Ö–æ–¥': 0.702,
            '–ö–æ–Ω–µ—á–Ω—ã–π_–æ—Å—Ç–∞—Ç–æ–∫': 0.0,  # –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
            '–ü–µ—Ä–∏–æ–¥_—Ö—Ä–∞–Ω–µ–Ω–∏—è_–¥–Ω–µ–π': 7
        }
    ]
    
    # –°–æ–∑–¥–∞–µ–º DataFrame –∏–∑ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    dataset = pd.DataFrame(test_data)
    
    # –°–æ–∑–¥–∞–µ–º —Å–∏—Å—Ç–µ–º—É —É—Å—É—à–∫–∏
    system = ShrinkageSystem()
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    print("üßÆ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...")
    results = system.process_dataset(
        dataset=dataset,
        source_filename="—Ä–µ–∞–ª—å–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ_–ë–´–ß–ö–ò_–í–Ø–õ–ï–ù–´–ï.xlsx",
        use_adaptive=True
    )
    
    print("\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞:")
    if results['status'] == 'success':
        print("‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ!")
        print(f"   –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –ø–æ–∑–∏—Ü–∏–π: {len(results['coefficients'])}")
        print(f"   –û—à–∏–±–æ–∫: {len(results['errors'])}")
        
        # –í—ã–≤–æ–¥–∏–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
        print("\nüîç –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã:")
        for coeff in results['coefficients']:
            print(f"   {coeff['–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞']}:")
            print(f"     a={coeff['a']:.6f}, b={coeff['b']:.6f}, c={coeff['c']:.6f}")
            print(f"     –¢–æ—á–Ω–æ—Å—Ç—å: {coeff['–¢–æ—á–Ω–æ—Å—Ç—å']:.2f}%")
    else:
        print(f"‚ùå –û—à–∏–±–∫–∞: {results.get('message', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞')}")


if __name__ == "__main__":
    test_real_data_with_warnings()